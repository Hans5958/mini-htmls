dayjs.extend(window.dayjs_plugin_utc);let timer,cors,currentCount=0,diffAvg=0,diffReal=0,initTimer=()=>Math.round(10*(63-new Date%6e4/1e3-4*Math.random()+2)),diffArray=[],parser=new DOMParser;const corsDetect=()=>new Promise(t=>{$.get("https://tscache.com/donation_total.json").done(function(){t("")}).fail(function(){$.get("https://cf-cors.hans5958.workers.dev/?url=https://tscache.com/donation_total.json").done(function(){t("https://cf-cors.hans5958.workers.dev/?url=")}).fail(function(){t(!1)})})}),getData=async(t,e,n)=>{return await fetch(cors+t)["catch"](n)},updateMargin=()=>{document.querySelector("#main p").textContent=currentCount,document.querySelector("#diff p").textContent=diffAvg,document.querySelector("#diffReal p").textContent=diffReal},updateDiff=(t,e)=>{if(!isNaN(t))return e.push(t),e.length>11&&e.shift(),Math.round(10*sumArray(e)/e.length)},updateStats=t=>{document.querySelector("#recentDonations").textContent="";let e=t.recent;for(let t in e){if(5==t)break;let n=e[t],a=n.name,r=Number(n.pounds.replace(/,/g,"")),o=dayjs(1e3*n.created_at),c=document.createElement("tr"),d=document.createElement("td"),i=document.createElement("td"),s=document.createElement("td");d.innerHTML=a,i.innerHTML="$"+r,s.innerHTML=dayjs(o).format("D/M/YYYY, H:mm:ss"),c.appendChild(d),c.appendChild(i),c.appendChild(s),document.querySelector("#recentDonations").append(c)}},sumArray=t=>t.reduce((t,e)=>t+e),afterGet=t=>{let e=t.total.count;currentCount&&(diffAvg=updateDiff(e-currentCount,diffArray),diffReal=e-currentCount,console.log(diffReal)),currentCount=e,updateMargin(),updateStats(t.lb)},reload=async()=>{let t=await(await getData("https://tscache.com/lb_recent.json")).json(),e=await(await getData("https://tscache.com/donation_total.json")).json();afterGet({lb:t,total:e})};$(async()=>{let t=dayjs.utc("2022-01-01 00:00");$("#countdown").countdown(t.toDate(),function(t){$(this).html(t.strftime("%D:%H:%M:%S"))}),cors=await corsDetect(),setInterval(async()=>{timer--,$("#update").html("Update: "+timer/10+"s"),timer||(timer=initTimer(),reload())},100)});