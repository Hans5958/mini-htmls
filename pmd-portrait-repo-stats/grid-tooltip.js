import{createPopper}from"https://cdn.skypack.dev/pin/@popperjs/core@v2.11.0-vNaZ2PjSixWsKsSynVha/mode=imports,min/optimized/@popperjs/core.js";let currentTarget,tempHidden=!1,generateGetBoundingClientRect=(t=0,e=0)=>()=>({width:0,height:0,top:e,right:t,bottom:e,left:t});const virtualElement={getBoundingClientRect:generateGetBoundingClientRect()},tooltipElement=document.querySelector("#tooltip"),instance=createPopper(virtualElement,tooltipElement,{placement:"right",modifiers:[{name:"flip",options:{fallbackPlacements:["left","top","right"]}}]}),updateTooltip=({clientX:t,clientY:e,target:o})=>{if(console.log(tempHidden),o.classList.contains(".viz-square")&&(document.querySelector(".viz-square:hover")?o=document.querySelector(".viz-square:hover"):(tempHidden=!1,virtualElement.getBoundingClientRect=generateGetBoundingClientRect(t,e),instance.update())),currentTarget!==o){currentTarget=o;const t=o,e=o.parentElement;tooltipElement.innerHTML=tooltipFunctions[e.dataset.tooltipFunction](t.dataset.tooltipId)}virtualElement.getBoundingClientRect=generateGetBoundingClientRect(t,e),instance.update()},showTooltip=()=>{tooltip.removeAttribute("hidden"),instance.setOptions({modifiers:[{name:"eventListeners",enabled:!0}]}),document.addEventListener("mousemove",updateTooltip)},hideTooltip=()=>{tooltip.hidden=!0,instance.setOptions({modifiers:[{name:"eventListeners",enabled:!1}]}),document.removeEventListener("mousemove",updateTooltip)};document.querySelectorAll(".viz-grid").forEach(t=>{t.addEventListener("mouseenter",showTooltip),t.addEventListener("mouseleave",hideTooltip)}),document.querySelector("#tooltip").addEventListener("mouseenter",updateTooltip);const tooltipDataGenerator={pokemon(t){let e=data.pokemons[t],o=e.forms[Object.keys(e.forms)[0]],r=o.portraits;o.preversed&&(r=r.concat(o.preversed));let i={Name:`${e.name} (${e.id})`,Status:"","Last modified":e.lastModified,"!imgDirPath":o.botPath,"!reversed":!!o.preversed,"!portrait":r,"!canvasId":"portrait-"+o.filename.replace(/portrait-(\d{4}(?:-(\d{4}))*)\.png/,"$1")};return 0===e.complete?i.Status="Missing":1===e.complete?i.Status="Incomplete (Exists)":2===e.complete&&(i.Status="Complete (Fully Featured)"),i},forms(t,e){let o=data.pokemons[t].forms[e],r=o.portraits;return o.preversed&&(r=r.concat(o.preversed)),{Name:"",Form:`${o.name} (${o.filename.replace(/portrait-(\d{4}(?:-(\d{4}))*)\.png/,"$1")})`,...this.pokemon(t),"Last modified":o.modified,"!imgDirPath":o.botPath,"!reversed":!!o.preversed,"!portrait":r,"!canvasId":"portrait-"+o.filename.replace(/portrait-(\d{4}(?:-(\d{4}))*)\.png/,"$1")}},portraits(t,e,o){let r=data.pokemons[t].forms[e],i=r.portraits;return r.preversed&&i.concat(r.preversed),{Name:"",Form:"",Portrait:`${data.portraitDict[o]} (${o})`,...this.forms(t,e),"!done":i[o]}}},tooltipFunctions={completionPokemon(t){let e="",o=tooltipDataGenerator.pokemon(t);return e+=Object.entries(o).filter(([t])=>!t.startsWith("!")).map(([t,e])=>`<p><span class="font-weight-bold">${t}</span>: ${e}</p>`).join(""),e+=`<div class="tooltip-img"><canvas id="${o["!canvasId"]}" width="200" height="${o["!reversed"]?"320":"160"}"></div>`,o["!portrait"].forEach((t,e)=>{if(!t)return;const r=new Image;r.src=`https://raw.githubusercontent.com/PMDCollab/SpriteCollab/master/portrait${o["!imgDirPath"]}${data.portraitDict[e%20]}${e>19?"^":""}.png`,r.onload=(()=>{try{document.querySelector(`#${o["!canvasId"]}`).getContext("2d").drawImage(r,e%5*40,40*Math.floor(e/5))}catch(t){}})}),e},completionForms(t){let e="",[o,r]=t.split(";"),i=tooltipDataGenerator.forms(...t.split(";"));return e+=Object.entries(i).filter(([t])=>!t.startsWith("!")).map(([t,e])=>`<p><span class="font-weight-bold">${t}</span>: ${e}</p>`).join(""),e+=`<div class="tooltip-img"><canvas id="${i["!canvasId"]}" width="200" height="${i["!reversed"]?"320":"160"}"></div>`,i["!portrait"].forEach((t,e)=>{if(!t)return;const o=new Image;o.src=`https://raw.githubusercontent.com/PMDCollab/SpriteCollab/master/portrait${i["!imgDirPath"]}${data.portraitDict[e%20]}${e>19?"^":""}.png`,o.onload=(()=>{try{document.querySelector(`#${i["!canvasId"]}`).getContext("2d").drawImage(o,e%5*40,40*Math.floor(e/5))}catch(t){}})}),e},completionPortraits(t){let e="",[o,r,i]=t.split(";"),a=tooltipDataGenerator.portraits(...t.split(";"));return e+=Object.entries(a).filter(([t])=>!t.startsWith("!")).map(([t,e])=>`<p><span class="font-weight-bold">${t}</span>: ${e}</p>`).join(""),a["!done"]&&(e+=`<div class="tooltip-img"><img src="https://raw.githubusercontent.com/PMDCollab/SpriteCollab/master/portrait${a["!imgDirPath"]}${data.portraitDict[i%20]}${i>19?"^":""}.png"></img></div>`),e},heatmapPokemon(t){return this.completionPokemon(t)},heatmapForms(t){return this.completionForms(t)}};