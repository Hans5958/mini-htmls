---
layout: default
title: TNKB Analyzer
description: This is a tool to analyze vehicle registration plate number (plate number) from Indonesia.
---

<style>
	#maindata {
		text-align: center;
		display: table-cell;
		vertical-align: middle;
		height: calc(100vh - 160px);
		width: 100vw;
		border: none;
	}

	p.result {
		font-size: 20px;
		margin-bottom: 0
	}

	#help {
		font-size: 15px;
		margin-top: 30px
	}

	#output {
		margin-top: 30px
	}

	body {
		vertical-align: middle;
		margin: 0
	}

	input {
		padding: 35px 0px 5px;
		width: 80vw;
		font-size: 30px;
		border: none;
		border-bottom: 2px solid #4287f5;
	}

	button:hover {
		transition-duration: 0.5s;
		background-color: #1d6ef0;
	}

	button:focus {
		outline: none;
	}

	input:focus {
		outline: none;
	}
</style>

<div id="maindata">
	<h3>TNKB Analyzer</h3>
	<input id="input" disabled></input>
	<p id="help">Enter a plate number from Indonesia to be analyzed.</p>
	<div id="output" class="row" style="display:none">
		<div id="tingkat1" div class="col-sm-12 col-lg-6">
			<h3>Daerah Tingkat 1</h3>
			<p class="result"></p>
			<p class="details"></p>
		</div>
		<div id="tingkat2" div class="col-sm-12 col-lg-6">
			<h3>Daerah Tingkat 2</h3>
			<p class="result"></p>
			<p class="details"></p>
		</div>
	</div>
</div>
<br>

<script>
	/*
	
	Initialization

	*/

	let firstTimeHelpHidden = false

	const inputField = document.getElementById("input")
	const outputField = document.getElementById("output")

	inputField.oninput = (e) => {
		inputField.value = inputField.value.toUpperCase()
		updateOutput(formatTNKB(inputField.value))
	}

	const formatTNKB = TNKB => {
		const regexResult = /([A-Za-z]{1,2}) ?([0-9]{1,5})? ?([A-Za-z0-9]{1,3})?/.exec(TNKB)
		if (regexResult) return regexResult.splice(1, 3)
		else return null
	}

	/* 

	Show time! 

	*/

	let dict

	$.getJSON("assets/other/tnkb-analyzer/dictMerged.json", json => {
		dict = json
		inputField.disabled = false
		dictCallback()
	})

	const updateOutput = formattedTNKB => {
		if (!firstTimeHelpHidden) {
			document.getElementById("help").style.display = "none"
		}
		document.querySelectorAll("#output p").forEach(e => e.textContent = "")
		document.querySelector("#output").style.display = "none"
		const [kodeWilayah, nomorPolisi, kodeAkhir] = formattedTNKB
		const [wilayah1, wilayah2] = analyzeTNKB(kodeWilayah, nomorPolisi, kodeAkhir)
		const setOutput = (element, value) => {
			if (typeof value === "string") {
				document.querySelector(`${element} .result`).innerHTML = value
				document.querySelector(`${element} .details`).innerHTML = ""
			} else if (typeof value === "object" && value !== null){
				document.querySelector(`${element} .result`).innerHTML = value[0]
				document.querySelector(`${element} .details`).innerHTML = value[1]
			} else { 
				document.querySelector(`${element} .result`).innerHTML = ""
				document.querySelector(`${element} .details`).innerHTML = ""
			}
		}
		setOutput("#tingkat1", wilayah1)
		setOutput("#tingkat2", wilayah2)
		document.querySelector("#output").style.display = ""
	}

	var analyzeTNKB = (kodeWilayah, nomorPolisi, kodeAkhir) => {
		if (dict[kodeWilayah].tingkat1) {
			const wilayah1 = dict[kodeWilayah].tingkat1
			let wilayah2
			if (typeof kodeAkhir === "string") {
				if (dict[kodeWilayah].tingkat2.from === "start") wilayah2 = dict[kodeWilayah].tingkat2.values[kodeAkhir[0]]
				else if (dict[kodeWilayah].tingkat2.from === "end") wilayah2 = dict[kodeWilayah].tingkat2.values[kodeAkhir[kodeAkhir.length - 1]]
				else if (dict[kodeWilayah].tingkat2.from === "single") wilayah2 = dict[kodeWilayah].tingkat2.values
				else if (dict[kodeWilayah].tingkat2.from === "function") wilayah2 = dict[kodeWilayah].tingkat2.values()
				else if (dict[kodeWilayah].tingkat2.from === null) wilayah2 = null
			} else {
				wilayah2 = null
			}
			return [wilayah1, wilayah2]
		} else {
			return false
		}
	}

	var dictCallback = () => {
		let TNKB,
			helpText,
			placeholderText = "Contoh"
		let updateInfo = () => {
			while (!TNKB) {
				let randomLetter = () => ('ABCDEFGHIJKLMNOPQRSTUVWXYZ').split('')[(Math.floor(Math.random()*26))]
				const kodeWilayah = Object.keys(dict)[Math.floor(Math.random()*Object.keys(dict).length)]
				const nomorPolisi = Math.round(((Math.random()*0.8999)+0.1)*10000)
				const kodeAkhir = randomLetter() + randomLetter()
				if (analyzeTNKB(kodeWilayah, nomorPolisi, kodeAkhir)[2] !== null) TNKB = `${kodeWilayah} ${nomorPolisi} ${kodeAkhir}` 
			}
			if (placeholderText === "Contoh") {
				helpText = "Enter a plate number from Indonesia to be analyzed."
				placeholderText = "Example"
			} else {
				helpText = "Masukkan sebuah nomor polisi kendaraan untuk dianalisis."
				placeholderText = "Contoh"
			}
			document.querySelector("#help").textContent = helpText
			inputField.placeholder = `${placeholderText}: ${TNKB}`
			TNKB = false
		}
		updateInfo()
		setInterval(updateInfo, 3000)
	}

	</script>

	