<!DOCTYPE html>
<html lang="en">

<head>
  <title>SourceForge Mirror Test - Hans5958's Mini HTMLs</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Mini HTMLs">
  <meta name="author" content="Hans5958">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/black/pace-theme-loading-bar.min.css">
  <script src="/mini-htmls/data/require.js"></script>
  <script>
    var cors

    function cors1() {
    	$.get("https://cors.io/?https://a.fsdn.com/allura/p/gnucash/icon?1523061114?&w=120", function () {
    			cors2("https://cors.io?")
    		})
    		.fail(function () {
    			$.get("https://api.codetabs.com/cors-proxy/https://a.fsdn.com/allura/p/gnucash/icon?1523061114?&w=120", function () {
    					cors2("https://api.codetabs.com/cors-proxy/")
    				})
    				.fail(function () {
    					$.get("https://jsonp.afeld.me/?url=https://a.fsdn.com/allura/p/gnucash/icon?1523061114?&w=120", function () {
    							cors2("https://jsonp.afeld.me/?url=")
    						})
    						.fail(function () {
    								errorFail()
    						})
    				})
    		})
    }

    function cors2(d) {
      console.log(d)
    	cors = d
    }

    function go() {
      let proj, file
      let mirrors = []
      $("table").toggle(false)
      $("#batch").toggle(false)
      let m = $("#link")[0].value.match(/https:\/\/sourceforge\.net\/projects\/(.*)\/files\/(.*)\/download/)
      proj = m[1]
      file = m[2]
      $("#mirrors").html("")
      $("#dialog").load(cors + "https://sourceforge.net/settings/mirror_choices?projectname=" + proj + "&filename=" + file + "&dialog=true", function() {
        $("#dialog li").each(function(i,v) {
          if (v.id != "autoselect") {
            mirrors.push(v.id)
          }
        })
        mirrors.sort()
        mirrors.forEach(function(shrt) {
          $("#mirrors").append("<tr><td><img src=\"assets/sourceforge-mirror-test/" + shrt + "-large.png\"></img></td><td><p>" + shrt + "</p></td><td><p>https://" + shrt + ".dl.sourceforge.net/project/" + proj + "/" + file + "</p></td></tr>")
          $("#batch")[0].innerHTML += "https://" + shrt + ".dl.sourceforge.net/project/" + proj + "/" + file + "\n"
        })
        $("table").toggle(true)
        $("#batch").toggle(true)
      })
    }

    cors1()
  </script>
  </head>

<body>
  <div id="overlay" style="position:fixed;position:fixed;z-index:1999;top:0;right:0;bottom:0;left:0;width:100%;height:100%;background-color:#fff;"></div>
  <div id="content">
    <div class="container">
      <h1>SourceForge Mirror Test</h1>
      <br/>
      <h6 style="font-weight: 600">Download link:</h6>
      <div class="input-group">
        <input type="text" class="form-control" id="link">
        <div class="input-group-append">
          <button class="btn btn-success" type="submit" id="go" onclick="go()">Go</button>
        </div>
      </div>
      <br/>
      <table class="table" style="display: none;">
        <thead>
          <tr>
            <th></th>
            <th>Short Name</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody id="mirrors">
        </tbody>
      </table>
      <br/>
      <pre id="batch" style="display: none;"></pre>
      <div id="dialog" class="d-none"></div>
      <br/> - SourceForge Mirror Test
    </div>
  </div>
</body>

</html>
