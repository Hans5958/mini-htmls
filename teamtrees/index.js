dayjs.extend(window.dayjs_plugin_utc);var timer,cors,currentCount=0,diffAvg=0,diffReal=0,initTimer=100,diffArray=[],parser=new DOMParser;const corsDetect=()=>new Promise(e=>{$.get("https://teamtrees.org/").done(function(){e("")}).fail(function(){$.get("https://cf-cors.hans5958.workers.dev/?url=https://teamtrees.org/").done(function(){e("https://cf-cors.hans5958.workers.dev/?url=")}).fail(function(){e(!1)})})}),getData=async(e,t,r)=>{return await fetch(cors+"https://teamtrees.org")["catch"](r)},updateMargin=()=>{document.querySelector("#main p").textContent=currentCount,document.querySelector("#diff p").textContent=diffAvg,document.querySelector("#diffReal p").textContent=diffReal},updateDiff=(e,t)=>{if(!isNaN(e))return t.push(e),t.length>61&&t.shift(),Math.round(60*sumArray(t)/t.length)},updateStats=e=>{$("#recentDonations")[0].innerHTML="";var t=[...e.querySelector("#recent-donations").children];for(let e in t){if(5==e)break;var r=t[e],n=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),i=document.createElement("td");a.innerHTML=r.querySelector("p.font-black").textContent,o.innerHTML="$"+r.querySelector("div.flex > div.badge").textContent.replace(/ trees?/,""),i.innerHTML=dayjs(r.querySelector("p.feed-datetime").textContent).format("D/M/YYYY, H:mm:ss"),n.appendChild(a),n.appendChild(o),n.appendChild(i),$("#recentDonations")[0].append(n)}},sumArray=e=>e.reduce((e,t)=>e+t),afterGet=e=>{var t=parser.parseFromString(e,"text/html"),r=t.querySelector("#totalTrees").dataset.count;currentCount&&(diffAvg=updateDiff(r-currentCount,diffArray),diffReal=r-currentCount),currentCount=r,updateMargin(),updateStats(t)},reload=async()=>{let e=await(await getData()).text();await afterGet(e)};$(async()=>{cors=await corsDetect(),setInterval(async()=>{timer--,$("#update").html("Update: "+timer/10+"s"),timer||(timer=initTimer,reload())},100)});