---
layout: default
title: Scratch Stats
description: Mini HTMLs 
---

  <script>

    /*

    this is not scratchstats.com clone
    i wrote this code by myself
    this code is 100000000% better than scratchstats.com
    trust me

    world_languages watch and learn lol

    */

    // One-time preparations

	var buildDate = "27/05/2019"
		
    var username, cors, profileData, proj1, proj2, page, pageDone, projDone, projN, projList, topProjects, dateJoined, activity, msgCount, report

    var stats = ["views", "loves", "favorites", "comments", "remixes"]
    var statsC = ["Views", "Loves", "Favorites", "Comments", "Remixes"]
    var statsP = ["viewed", "loved", "favorited", "commented", "remixed"]
    var statsPC = ["Viewed", "Loved", "Favorited", "Commented", "Remixed"]

    function _log(logR, error) {
        if (typeof logR === "string") {
          log = logR
        } else {
          log = ""
        }
        console.log("[SS] " + log)
        $("pre#log")[0].innerHTML = $("pre#log")[0].innerHTML + log + "\n"
        $("pre#log")[0].scrollTop = $("pre#log")[0].scrollHeight;
        if (typeof error === "boolean") {
          $("#username")[0].disabled = false
        }
    }

    function _report(reportedR) {
      if (typeof reportedR === "string") {
        reported = reportedR
      } else {
        reported = ""
      }
      report.push(reported)
    }

    // Timer, you get it.
    var ms = 0
    var Interval

    function stopTimer() {
      clearInterval(Interval)
    }

    function startTimer() {
      Interval = setInterval(function(){ms++}, 1);
    }

    // Initialization for dynamic execution.
    function init(callback) {
      $("#username")[0].disabled = true
      _log()
      _log("Scratch Stats starting...")
      _log("Preparing...")

      stopTimer()
      startTimer()

      report = []
      proj2 = []
      page = 0
      pageDone = 0
      projDone = 0
      projList = []
      topProjects = {
       "views": {},
       "loves": {},
       "favorites": {},
       "comments": {},
       "remixes": {},
       "oldest": {},
       "newest": {}
      }
      sortLists = {
       "views": {},
       "loves": {},
       "favorites": {},
       "comments": {},
       "remixes": {}
      }
      totalStats = {"views": 0, "loves": 0, "favorites": 0, "comments": 0, "remixes": 0}
      avgStats = {"views": 0, "loves": 0, "favorites": 0, "comments": 0, "remixes": 0}
      activity = {"favorite": 0, "love": 0, "studioadd": 0, "studiofollow": 0, "userfollow": 0, "studiocurator": 0, "studiomanager": 0, "share": 0, "total": 0}

      // Selecting CORS proxy.

      function corsDetect(callback) {
        $.getJSON("https://cors.io/?https://api.scratch.mit.edu", function () {
          callback("https://cors.io?")
        })
          .fail(function () {
            $.getJSON("https://api.codetabs.com/cors-proxy/https://api.scratch.mit.edu", function () {
              callback("https://api.codetabs.com/cors-proxy/")
            })
              .fail(function () {
                $.getJSON("https://jsonp.afeld.me/?url=https://api.scratch.mit.edu", function () {
                  callback("https://jsonp.afeld.me/?url=")
                })
                  .fail(function () {
                    callback(false)
                  })
              })
          })
        }

      _log("Selecting CORS proxy...")
      corsDetect(function(r1) {
        if (r1) {
          _log("CORS proxy selected! " + r1)
          cors = r1
          callback()
        } else {
          _log("CORS proxy failed! Aborting operation.", true)
        }
      })
    }

    // Obtaining user's data, if failed then such user don't exist.
    function execProfile(callback) {
        username = $("#username")[0].value
        _log("Username: " + username)
        _log("Finding user...")
        $.getJSON(cors + "https://api.scratch.mit.edu/users/" + username)
          .done(function(data) {
            _log("User found!")
            profileData = data
            console.log(data)
            dateJoined = new Date(data.history.joined)
            callback()
          })
          .fail(function() {
            _log("User not found! Aborting operation.", true)
          })
      }

    // A new method of obtaining project's data with a single API for listing projects.
    // Due to a bug, the remixes are counted as zero. The alternative method is used instead.
    function execProject(callback) {

        function gallery(pg) {
          _log("Analyzing page " + pg + "...")
          $.getJSON(cors + "https://api.scratch.mit.edu/users/" + username + "/projects/?limit=40&offset=" + pg*40, function(data) {
            _log("Analyzed page " + pg + ".")
            _log("Total projects now: " + projList.length)
            if (data.length != 0) {
              data.forEach(function(v) {
                _log(v.id + " " + v.title)
                projList.push({"id": v.id, "title": v.title, "stats": v.stats})
              })
              gallery(pg+1)
            } else {
              _log("All pages analyzed and all project's statistics obtained!")
              callback()
            }
          })
        }

        gallery(0)

      }

    // An alternative, old method of obtaining project's data by fetch the lists of projects
    // and fetch the project's data manually.
    function execProjectAlt(callback1) {
        function execProjectList(callback2) {
          _log("Retrieving projects list...")
          function funcCallback(p) {
            _log("Analyzed page " + p + " of " + page + ".")
            _log("Total projects now: " + proj2.length)
            pageDone++
            if (pageDone == page) {
              callback2()
            }
          }
          $.get(cors + "https://scratch.mit.edu/users/" + username + "/projects/")
            .done(function(data1) {
              proj1 = data1.match(/project\/\d+/gm)
              proj2 = proj2.concat(proj1)
              lol = data1.match(/<span class="page-current/gm)
              if (data1.match(/<span class="page-current/gm) === null) {
                page = 1
              } else {
                page = data1.match(/<span class="page-current/gm).length
              }
              _log("Projects retrieved!")
              _log("Analyzing " + page + " page(s)...")

              // Starts the analyze process.
              funcCallback(1)
              if (page > 1) {
                  for (var i = 2; i < page + 1; i++) {
                    $.get(cors + "https://scratch.mit.edu/users/" + username + "/projects/?page=" + i, function(data2) {
                        proj1 = data2.match(/project\/\d+/gm)
                        proj2 = proj2.concat(proj1)
                        funcCallback(i)
                      })
                  }
                }
              })
          }

        function execProjectData(callback2) {
          _log("All pages analyzed!")
          _log("Total projects: " + proj2.length)
          projN = proj2.length
          _log("Obtaining " + projN + " project's statistics...")
          for (var i2 = 0; i2 < projN + 1; i2++) {
            $.getJSON(cors + "https://api.scratch.mit.edu/projects/" + proj2[i2].match(/\d+/g))
              .done(function(data) {
                projDone++
                _log("Obtained project's statistics " + projDone + " of " + projN + ".")
                _log(data.id + " " + data.title)
                console.log(data)
                projList.push({"id": data.id, "title": data.title, "stats": data.stats})
                if (projN == projDone) {
                  _log("All project's statistics obtained!")
                  callback2()
                }
              })
              .fail(function() {
                projDone++
                _log("Failed to obtain project's statistics " + projDone + " of " + projN + ".")
                _log(data.id)

                if (projN == projDone) {
                  _log("All project's statistics obtained!")
                  callback2()
                }
              })
          }
        }

        execProjectList(function() {
          execProjectData(function() {
            callback1()
          })
        })
      }

    // Analyzing the project's for its stats.
    function execProjectStats(callback) {
        _log("Analyzing all projects...")
        stats.forEach(function (v1) {
          sortLists[v1] = Array.from(projList)
          sortLists[v1].sort(function(a, b) {
            return b.stats[v1] - a.stats[v1];
          })
          topProjects[v1] = sortLists[v1][0]
          projList.forEach(function(v2) {
            totalStats[v1] += v2.stats[v1]
          })
          avgStats[v1] = Math.round(totalStats[v1] / projList.length)
        })
        topProjects.oldest = projList[0]
        topProjects.newest = projList[projList.length - 1]

        _log("All projects analyzed!")
        callback()
      }

    // Obtaining user activity.
    function execActivity(callback) {
        _log("Analyzing user activity...")
        $.get(cors + "https://scratch.mit.edu/messages/ajax/user-activity/?user=" + username + "&max=99999", function(data) {
            function actMatch(regex) {
              return (data.match(regex) === null) ? 0 : data.match(regex).length
            }
            console.log(data)
            activity.favorite = actMatch(/favorites/g)
            activity.love = actMatch(/loves/g)
            activity.studioadd = actMatch(/added/g)
            activity.studiofollow = actMatch(/following the/g)
            activity.userfollow = actMatch(/following (?!the)/g)
            activity.studiocurator = actMatch(/became/g)
            activity.studiomanager = actMatch(/promoted/g)
            activity.share = actMatch(/shared/g)
            activity.total = actMatch(/\/li/g)
            _log("User activity analyzed!")
            callback()
          })
      }

    // Obtaining message count of a user.
    // Let's be honest, it is useless but novelty.
    function execMessages(callback) {
        _log("Obtaining message count...")
        $.getJSON(cors + "https://api.scratch.mit.edu/users/" + username + "/messages/count", function(data) {
          msgCount = data.count
          _log("Message count obtained!")
          callback()
        })
      }

    // End of the execution.
    function execEnd() {
		_log("Printing report...")
        _report("Hans5958's Scratch Stats (build date " + buildDate + ")")
        _report("Report of " + profileData.username)
        _report()
        _report("Data obtained on " + moment().tz(moment.tz.guess()).format("dddd, D MMMM YYYY, H:mm:ss z") + ".")
        _report("Vanity URL: " + window.location)
        _report()
        _report("Username: " + profileData.username)
        _report("ID: " + profileData.id)
        _report("Join Date: " + moment.tz(dateJoined, "GMT").tz(moment.tz.guess()).format("dddd, D MMMM YYYY, H:mm:ss z"))
        _report("Country: " + profileData.profile.country)
        _report("Projects Shared: " + proj2.length)
        _report("Current Message Count: " + msgCount)
        _report()
        _report("User Activity (each limited to 20)")
        _report("Projects Loved: " + activity.love)
        _report("Projects Favorited: " + activity.favorite)
        _report("Projects Shared: " + activity.share)
        _report("Users Followed: " + activity.userfollow)
        _report("Projects Added to Studio: " + activity.studioadd)
        _report("Studios Curated: " + activity.studiocurator)
        _report("Studios Managed: " + activity.studiomanager)
        _report("Total: " + activity.total)
        _report()
        stats.forEach(function(v, i) {
          _report("Total " + statsC[i] + ": " + totalStats[v])
        })
        _report()
        stats.forEach(function(v, i) {
          _report("Average " + statsC[i] + ": " + avgStats[v])
        })
        _report()
        stats.forEach(function(v, i) {
          _report("Most " + statsPC[i] + " Project: " + topProjects[v].title + " (" + topProjects[v].stats[v] + ")")
        })
        _report()
        _report("Oldest Project: " + topProjects.oldest.title + " (" + topProjects.oldest.id + ")")
        _report("Newest Project: " + topProjects.newest.title + " (" + topProjects.newest.id + ")")
        _report()
        _report("Lists Of Stats:")
        _report()
        _report("Projects: (id / views / loves / comments / favorites / remixes)")
        projList.forEach(function(v, i) {
          i++
          _report(i + ". " + v.title + " (" + v.id + " / " + v.stats.views + " / " + v.stats.loves + " / " + v.stats.comments + " / " + v.stats.favorites + " / " + v.stats.remixes + ")")
        })
        stats.forEach(function(v1, i) {
          _report()
          _report("Most " + statsPC[i] + " Project:")
          sortLists[v1].forEach(function(v2, i) {
            i++
            _report(i + ". [" + v2.stats[v1] + "] " + v2.title)
          })
        })
        _log()
        _log("================================")
        _log()
        report.forEach(function(v) {
          _log(v)
        })
        _log()
        _log("================================")
        _log()
        stopTimer()
		_log("Report printed!")
        _log("Operation completed in " + ms/1000 + " seconds.", true)
      }

    // Execution triggers, including has for short url and edge cases.
    $(function() {
      $("input")[0].value = (window.location.hash) ? window.location.hash.slice(1):"Hans5958"
	  window.location.hash = $("input")[0].value
      go()
      $("#username").change(function() {
        go()
		window.location.hash = $("input")[0].value
		$("input")[0].value = window.location.hash.slice(1)
      })
      window.onhashchange = function() {
	    go()
        $("input")[0].value = window.location.hash.slice(1)
		window.location.hash = $("input")[0].value
      }
    })

    // The execution!
    function go() {
      if ($("#username")[0].disabled === false) {
        init(function() {
          execProfile(function() {
            execProjectAlt(function() {
              execProjectStats(function() {
                execActivity(function() {
                  execMessages(function() {
                    execEnd()
                  })
                })
              })
            })
          })
        })
      }
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.25/moment-timezone-with-data-10-year-range.js"></script>

    <div class="container">
      <div class="row">
        <form>
          <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" id="username" placeholder="Username" value="Hans5958">
          </div>
        </form>
      </div>
      <div class="row">
        <!--
        <div id="username">
          <h2>Username</h2>
          <p></p>
        </div>
        <div id="userid">
          <h2>ID</h2>
          <p></p>
        </div>
        <div id="joindate">
          <h2>Date Joined</h2>
          <p></p>
        </div>
        <div id="country">
          <h2>Country</h2>
          <p></p>
        -->
        <pre id="log" style="height:calc(100vh - 250px);width:100%;overflow:auto"></pre>
      </div>
    </div>